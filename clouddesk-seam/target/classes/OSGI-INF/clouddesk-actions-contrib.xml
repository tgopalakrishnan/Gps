<?xml version="1.0"?>
<component name="com.sharplabs.clouddesk.actions">

	<require>org.nuxeo.ecm.platform.webengine.sites.actions</require>
	<require>org.nuxeo.ecm.social.workspace.actions</require>

	<extension target="org.nuxeo.ecm.platform.actions.ActionService"
		point="actions">

		<action id="clouddesk_home" link="cd_view_home" label="label.main.tab.home"
			order="0">
			<category>CLOUDDESK_MAIN_TABS</category>
		</action>

		<action id="clouddesk_my_documents" link="view_documents"
			label="label.main.tab.myDocuments" order="10">
			<category>CLOUDDESK_MAIN_TABS</category>
		</action>

		<action id="clouddesk_shared_with_me" link="others_docs_search_results"
			label="label.main.tab.sharedWithMe" order="20">
			<category>CLOUDDESK_MAIN_TABS</category>
		</action>
		<!--  To hide wall in all places in Clouddesk -->
		<action id="TAB_WORKSPACE_WALL" link="/incl/tabs/default_document_wall.xhtml" order="15" enabled="false"
         label="action.view.wall" icon="/icons/file.gif">
         <category>VIEW_ACTION_LIST</category>
         <filter-id>showWorkspaceWall</filter-id>
        </action>
		
		

		<!-- <action id="clouddesk_projects" link="view_documents" label="label.main.tab.projects" 
			order="30"> <category>CLOUDDESK_MAIN_TABS</category> </action> -->

		<!-- <action id="clouddesk_projects" link="view_clouddesk_settings" label="label.main.tab.settings" 
			order="40"> <category>CLOUDDESK_MAIN_TABS</category> </action> -->

		<!-- TODO: special admin view for the business admin <action id="clouddesk_businessadmin" 
			link="view_clouddesk_businessadmin" label="label.main.tab.businessadmin" 
			order="100"> <category>CLOUDDESK_MAIN_TABS</category> <filter-id>only_for_businessadmin</filter-id> 
			</action> -->

		<action id="clouddesk_admin" link="view_admin" label="label.main.tab.admin.center"
			order="110">
			<category>CLOUDDESK_MAIN_TABS</category>
			<filter-id>only_for_manager</filter-id>
		</action>
		<!-- Hide document tabs that are not availabe by default TODO: Compute 
			dynamic filters based on the package feature of the current user profile. -->

		<!-- hide the work flow -->

		<action id="TAB_CONTENT_JBPM" enabled="false">
			<filter-id>has_workflow_enabled</filter-id>
		</action>

		<action id="TAB_FILES_EDIT" enabled="false"></action>
		<action id="TAB_PUBLISH" enabled="false"></action>
		<!-- <action id="TAB_RELATIONS" enabled="false"></action> -->

		<action id="CLOUDDESK_TAB_CONTENT" link="/incl/tabs/document_content.xhtml"
			order="10" label="action.view.contents" icon="/icons/file.gif">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>view_content</filter-id>
			<filter-id>outSection</filter-id>
		</action>

		<!-- Actions for the document selection -->

		<action id="CURRENT_SELECTION_COPY" link="#{clipboardActions.putSelectionInClipboard}"
			label="command.clipboard.copy" icon="" order="10">
			<category>CURRENT_SELECTION_LIST</category>
			<filter-id>canCopyFromCurrentSelection</filter-id>
		</action>

		<action id="CLIPBOARD_PASTE" link="#{clipboardActions.pasteClipboard}"
			label="command.clipboard.paste" icon="" order="20">
			<category>CURRENT_SELECTION_LIST</category>
			<filter id="canPastFromClipboard">
				<rule grant="true">
					<condition>#{clipboardActions.canPasteFromClipboard}</condition>
				</rule>
			</filter>
		</action>

		<action id="CURRENT_SELECTION_ADDTOLIST" enabled="false"
			link="#{clipboardActions.putSelectionInDefaultWorkList}" label="help.command.clipboard.addworklist"
			icon="" order="30">
			<category>CURRENT_SELECTION_LIST</category>
			<filter-id>canCopyFromCurrentSelection</filter-id>
			<filter id="no_addtolist_for_domains">
				<rule grant="false">
					<type>Root</type>
				</rule>
			</filter>
		</action>

		<action id="CURRENT_SELECTION_TRASH" link="#{deleteActions.deleteSelection}"
			label="command.trashDocs" icon="" help="comand.trashDocs.help"
			confirm="if( !confirmDeleteDocuments() ) return false;" order="40">
			<category>CURRENT_SELECTION_LIST</category>
			<filter id="canDelete">
				<rule grant="true">
					<condition>#{deleteActions.canDelete}</condition>
				</rule>
			</filter>
		</action>

		<action id="TAB_EDIT" link="/incl/tabs/document_edit.xhtml"
			order="20" label="action.view.modification" icon="/icons/file.gif">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>edit</filter-id>
			<filter-id>mutable_document</filter-id>
		</action>

		<action id="TAB_WORKSPACE_EDIT" link="/incl/tabs/ws_document_edit.xhtml"
			order="22" label="action.view.modification" icon="/icons/file.gif">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>workspace_edit</filter-id>
			<filter-id>mutable_document</filter-id>
		</action>

		<action id="TAB_MY_SUBSCRIPTIONS" link="/incl/tabs/document_subscriptions.xhtml"
			order="70" enabled="false" label="action.subscriptions.tab" icon="/icons/file.gif">
			<category>VIEW_ACTION_LIST</category>
			<filter-id>general_documents</filter-id> <filter-id>not_anonymous</filter-id>
		</action>

		<action id="CLOUDDESK_TAB_WORKSPACE_ALERTS" label="label.clouddesk.alerts"
			link="/incl/tabs/document_subscriptions.xhtml" order="26" enable="true">
			<category>VIEW_ACTION_LIST </category>
			<filter-id>workspace_alert</filter-id>
			<filter-id> mutable_document</filter-id>
		</action>

		<action id="CLOUDDESK_TAB_MANAGE_SUBSCRIPTIONS" link="/incl/tabs/cd_document_group_subscriptions.xhtml"
			order="80" enabled="true" label="action.groups.subscriptions.tab"
			icon="/icons/file.gif">
			<category>CLOUDDESK_TAB_MANAGE_sub_tab</category>
			<filter-id>general_documents</filter-id>
			<filter-id>manage_subscriptions</filter-id>
		</action>





		<action id="CLOUDDESK_TAB_MANAGE" link="/incl/tabs/document_manage.xhtml"
			order="240" label="action.view.manage" icon="/icons/file.gif">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>manage</filter-id>
			<filter id="TAB_MANAGE_has_subtabs">
				<rule grant="false">
					<condition>
						#{webActions.getActionsList('TAB_MANAGE_sub_tab').isEmpty()}
					</condition>
				</rule>
			</filter>
		</action>

		<action id="CLOUDDESK_TAB_RIGHTS" link="/incl/tabs/document_rights.xhtml"
			order="50" label="action.view.rights" icon="/icons/file.gif">
			<category>CLOUDDESK_TAB_MANAGE_sub_tab</category>
			<filter-id>rights</filter-id>
		</action>

		<action id="TAB_VIEW" link="/incl/tabs/document_view.xhtml"
			order="0" label="action.view.summary" icon="/icons/file.gif">
			<category>CD_VIEW_ACTION_LIST</category>
			<filter-id>view</filter-id>
		</action>

		<!--METADATA -->

		<action id="clouddesk_tab_metadata_picture" link="/incl/tabs/metadata_picture.xhtml"
			enabled="true" label="action.view.metadata" order="24">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>hasPictureFacet</filter-id>
		</action>

		<!--NOTES -->

		<action id="view_comments" link="/incl/tabs/document_comments.xhtml"
			enabled="true" order="80" label="action.view.comments">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>commentable</filter-id>
			<filter-id>mutable_document</filter-id>
			<filter-id>not_anonymous</filter-id>
		</action>

 
		<!-- Links -->

		<action id="CLOUDDESK_TAB_RELATIONS" link="/incl/tabs/document_relations.xhtml"
			enabled="true" label="action.view.relations" order="55">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter id="view_relations">
				<rule grant="true">
					<permission>Read</permission>
				</rule>
				<rule grant="false">
					<facet>Folderish</facet>
				</rule>
				<rule grant="false">
					<type>Server</type>
				</rule>
			</filter>
		</action>

		<action id="exportView" enabled="false">
			<filter-id>has_workflow_enabled</filter-id>
		</action>

		<!--hide the manage -->


		<action id="TAB_SOCIAL_WORKSPACE_PRIVATE_DASHBOARD"
			link="/incl/tabs/social_workspace_private_dashboard.xhtml" order="5"
			label="action.view.private.dashboard" icon="/icons/file.gif" enabled="false">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>social_workspace</filter-id>
		</action>

		<action id="TAB_SOCIAL_WORKSPACE_PUBLIC_DASHBOARD" link="/incl/tabs/social_workspace_public_dashboard.xhtml"
			order="16" label="action.view.public.dashboard" icon="/icons/file.gif"
			enabled="false">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>manage_social_workspace</filter-id>
			<filter-id>social_workspace</filter-id>
		</action>

		<action id="TAB_MANAGE_SOCIAL_WORKSPACE"
			link="/incl/tabs/social_workspace_groupManager_action_tabs.xhtml"
			order="10" enabled="false" label="action.view.membership.management"
			icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage_social_workspace</filter-id>
		</action>

		<action id="TAB_MANAGE_SOCIAL_WORKSPACE_BULK_INVITE" link="/incl/tabs/social_workspace_bulk_invite_tabs.xhtml"
			order="15" enabled="false" label="tab.userregistration.requests.multiple.create"
			icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage_social_workspace</filter-id>
		</action>

		<action id="TAB_MANAGE_SOCIAL_WORKSPACE_SIMPLE_INVITE"
			link="/incl/tabs/social_workspace_simple_invite_tabs.xhtml" order="15"
			enabled="false" label="tab.userregistration.requests.create" icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage_social_workspace</filter-id>
		</action>


		<action id="CLOUDDESK_TAB_TRASH_CONTENT" link="/incl/tabs/document_trash_content.xhtml"
			order="200" label="action.view.trash.content" icon="/icons/file.gif">
			<category>CLOUDDESK_TAB_MANAGE_sub_tab</category>
			<filter id="viewTrash">
				<rule grant="true">
					<permission>Manage everything</permission>
					<facet>Folderish</facet>
					<condition>#{deleteActions.trashManagementEnabled}</condition>
				</rule>
			</filter>
		</action>
		<action id="TAB_MANAGE_SUBSCRIPTIONS" link="/incl/tabs/document_group_subscriptions.xhtml"
			order="80" enabled="false" label="action.groups.subscriptions.tab"
			icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>general_documents</filter-id>
			<filter-id>manage_subscriptions</filter-id>
		</action>
		<!-- <action id="UserRegistrationRequests" link="/incl/userregistration/requests_listing_all.xhtml" 
			enabled="false" label="tab.userregistration.requests" order="10"> <category>UserRegistration_sub_tab</category> 
			<filter-id>only_for_manager</filter-id> </action> -->
		<action id="UserRegistrationRequestsCreate" order="220"
			enabled="false" label="tab.userregistration.requests.create">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage</filter-id>
			<filter-id>mutable_document</filter-id>
		</action>

		<action id="UserRegistrationRequestsMultipleCreate" order="230"
			enabled="false" label="tab.userregistration.requests.multiple.create">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage</filter-id>
			<filter-id>mutable_document</filter-id>
		</action>

		<action id="UserRegistrationRequestsListingLocal"
			link="/incl/userregistration/requests_listing_local.xhtml" order="240"
			enabled="false" label="tab.userregistration.requests">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>manage</filter-id>
			<filter-id>mutable_document</filter-id>
			<filter id="displayRegistrationListingLocal">
				<rule grant="true">
					<condition>#{userRegistrationConfigurationActions.getRules('default_registration').isDisplayLocalTab()}
					</condition>
				</rule>
			</filter>
		</action>


		<action id="TAB_CONTENT_HISTORY" link="/incl/tabs/document_history.xhtml"
			enabled="true" label="action.view.history" icon="/icons/file.gif"
			order="100">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>TAB_CONTENT_HISTORY_has_subtabs</filter-id>
		</action>

		<action id="TAB_EVENTS" link="/incl/tabs/document_events_cv.xhtml"
			enabled="true" label="action.view.events" icon="/icons/file.gif"
			order="50">
			<category>CLOUDDESK_TAB_CONTENT_HISTORY_sub_tab</category>
			<filter-id>view_content_history</filter-id>
		</action>

		<action id="TAB_VERSIONS" link="/incl/tabs/document_versions.xhtml"
			enabled="true" label="action.view.versions" icon="/icons/file.gif"
			order="100">
			<category>CLOUDDESK_TAB_CONTENT_HISTORY_sub_tab</category>
			<filter-id>versionable</filter-id>
		</action>

		<action id="VIEW_VERSION" link="#{versionedActions.viewArchivedVersion}"
			label="command.viewArchivedVersion" order="10">
			<category>CLOUDDESK_VERSION_LIST_ITEM</category>
		</action>

		<action id="RESTORE_VERSION" link="#{versionedActions.restoreToVersion}"
			label="command.restore" order="20">
			<category>CLOUDDESK_VERSION_LIST_ITEM</category>
			<filter-id>canRestoreVersion</filter-id>
		</action>

		<action id="CLOUDDESK_CURRENT_VERSION_SELECTION_DELETE" link="#{versionedActions.removeSelectedArchivedVersions}"
			label="command.removeSelectedArchivedVersions" confirm="if( !confirmDeleteDocuments() ) return false;"
			order="10">
			<category>CURRENT_VERSION_SELECTION_LIST</category>
			<filter-id>canDeleteCurrentVersionSelection</filter-id>
		</action>



		<action id="CLOUDDESK_tab_imageview" link="/incl/tabs/picture_view.xhtml"
			enabled="true" label="action.view.picture" order="22">
			<category>CLOUDDESK_VIEW_ACTION_LIST</category>
			<filter-id>hasPictureFacet</filter-id>
		</action>

		<action id="TAB_LOCAL_CONFIGURATION" link="/incl/tabs/local_configuration.xhtml"
		enabled="false"	order="70" label="action.view.local.configuration" icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>has_local_configuration_available</filter-id>
		</action>

		<action id="TAB_ADMIN_PUBLICATION_TREES" link="/incl/tabs/admin_publication_trees.xhtml"
		 enabled="false"	order="110" label="action.admin.publication.tree" icon="/icons/file.gif">
			<category>TAB_MANAGE_sub_tab</category>
			<filter-id>admin_publication_trees_filter</filter-id>
		</action>


        <action id="CLOUDDESK_documentLock" link="#{lockActions.lockCurrentDocument}"
         order="10" label="command.lock" type="link" icon="/icons/contextual_menu/Lock_Icon.png">
          <category>CLOUDDESK_DOCUMENT_UPPER_ACTION</category>
          <filter-id>mutable_document</filter-id>
         <filter-id>can_lock</filter-id>
       </action>

    <action id="CLOUDDESK_documentUnlock" link="#{lockActions.unlockCurrentDocument}"
      order="10" label="command.unlock" type="link" icon="/icons/contextual_menu/UnLock_Icon.png">
      <category>CLOUDDESK_DOCUMENT_UPPER_ACTION</category>
      <filter-id>mutable_document</filter-id>
      <filter-id>can_unlock</filter-id>
    </action>
    
    <action id="CLOUDDESK_POPUP_sendEmail" link="javascript:doSendEmail" order="150"
      label="action.email.document" icon="/icons/Mail_Icon.png">
      <category>CLOUDDESK_POPUP</category>
      <filter-id>not_folder</filter-id>
    </action>

<action id="showFancyBoxPreview" order="50" type="fancybox" enabled="true"
      label="label.document.preview" icon="/icons/contextual_menu/preview.png">
      <category>DOCUMENT_UPPER_ACTION</category>
      <filter-id>view_preview</filter-id>
      <filter-id>not_folder</filter-id>
      <filter-id>not_anonymous</filter-id>
   <properties>
        <property name="iframe">
          #{previewActions.getCurrentDocumentPreviewPopupURL()}
        </property>
      </properties> 
    </action>

	</extension>

	<extension point="filters"
		target="org.nuxeo.ecm.platform.actions.ActionService">
		<filter id="social_workspace">
			<rule grant="false">
				<facet>SocialWorkspace</facet>
			</rule>
		</filter>

		<filter id="manage_social_workspace">
			<rule grant="false">
				<permission>Manage everything</permission>
				<facet>SocialWorkspace</facet>
			</rule>
		</filter>

		<filter id="has_workflow_enabled">
			<rule grant="true">
				<condition>
					#{userFeaturesActions.hasFeatureEnabled("WORKFLOW")}
				</condition>
			</rule>
		</filter>

		<filter id="not_anonymous">
			<rule grant="false">
				<condition>#{currentUser.anonymous}</condition>
			</rule>
		</filter>

		<filter id="commentable">
			<rule grant="true">
				<facet>Commentable</facet>
			</rule>
		</filter>

		<!-- <filter id="view"> <rule grant="true"> <facet>Folderish</facet> </rule> 
			</filter> -->

		<filter id="edit">
			<rule grant="false">
				<type>Root</type>
				<type>Domain</type>
				<type>WorkspaceRoot</type>
				<type>Workspace</type>
				<type>Folder</type>
			</rule>
			<rule grant="true">
				<permission>Write</permission>
			</rule>
		</filter>

		<filter id="view_content">
			<rule grant="true">
				<permission>ReadChildren</permission>
				<facet>Folderish</facet>
			</rule>
		</filter>

		<filter id="outSection">
			<rule grant="false">
				<type>Section</type>
				<type>SectionRoot</type>
			</rule>
		</filter>

		<filter id="workspace_edit">
			<rule grant="true">
				<type>Domain</type>
				<type>WorkspaceRoot</type>
				<type>Workspace</type>
				<type>Folder</type>	
				<permission>WriteSecurity</permission>
			</rule>
		</filter>

		<filter id="mutable_document">
			<rule grant="false">
				<facet>Immutable</facet>
			</rule>
			<rule grant="false">
				<type>Root</type>
			</rule>
			<rule grant="false">
				<condition>
					document.getCurrentLifeCycleState().equals("deleted")
				</condition>
			</rule>
		</filter>

		<filter id="general_documents">
			<rule grant="false">
				<type>Root</type>
				<type>Domain</type>
				<type>WorkspaceRoot</type>
				<type>SectionRoot</type>
			</rule>
		</filter>

		<filter id="manage_subscriptions">
			<rule grant="true">
				<permission>WriteSecurity</permission>
			</rule>
		</filter>

		<filter id="TAB_CONTENT_HISTORY_has_subtabs">
			<rule grant="false">
				<condition>
					#{webActions.getActionsList('TAB_CONTENT_HISTORY_sub_tab').isEmpty()}
				</condition>
			</rule>
		</filter>

		<filter id="view_content_history">
			<rule grant="false">
				<type>WorkspaceRoot</type>
				<type>SectionRoot</type>
				<type>Server</type>
			</rule>
			<rule grant="false">
				<facet>Immutable</facet>
			</rule>
		</filter>

		<filter id="hasPictureFacet">
			<rule grant="true">
				<facet>Picture</facet>
			</rule>
		</filter>
		<filter id="not_folder">
			<rule grant="false">
				<facet>Folderish</facet>
			</rule>
		</filter>
		<filter id="canCopyFromCurrentSelection">
			<rule grant="true">
				<condition>#{clipboardActions.canCopy}</condition>
			</rule>
		</filter>

		<filter id="manage">
			<rule grant="true">
				<permission>Manage everything</permission>
			</rule>
		</filter>


		<filter id="only_for_manager">
			<rule grant="true">
				<condition>#{userSession.administrator}</condition>
			</rule>
		</filter>
		<filter id="rights">
			<rule grant="true">
				<permission>WriteSecurity</permission>
				<facet>Folderish</facet>
			</rule>
		</filter>


		<filter id="manage_social_workspace">
			<rule grant="true">
				<permission>Manage everything</permission>
				<facet>SocialWorkspace</facet>
			</rule>
		</filter>
		
		
  <filter id="has_local_configuration_available">
      <rule grant="false">
        <condition>
          #{webActions.getActionsList('LOCAL_CONFIGURATION').isEmpty()}
        </condition>
      </rule>
      <rule grant="true">
        <permission>Manage everything</permission>
        <facet>SuperSpace</facet>
      </rule>
    </filter>

 <filter id="admin_publication_trees_filter">
      <rule grant="true">
        <permission>Write</permission>
        <schema>publishing</schema>
      </rule>
    </filter>
    <!-- To disable wall in all places in clouddesk -->
	 <filter id="showWorkspaceWall">
      <rule grant="false">
        <type>Workspace</type>
      </rule>
    </filter>
		
		<filter id="view_preview">
      <rule grant="true">
        <condition>#{previewActions.hasPreview}</condition>
      </rule>
    </filter>

	</extension>
</component>